# TODO: Upgrade to circle 2.0 syntax
machine:
  xcode:
    version: "9.0"

dependencies:
  pre:
    - gem install xcpretty
    - gem install cocoapods -v $(var=$(tail -1 Podfile.lock); echo ${var##COCOAPODS:})
  override:
    - make dependencies
  cache_directories:
    - ./Pods
    - ~/.cocoapods

test:
  override:
    - make build-pretty
    - make test-pretty
    - make lint
    - make carthage
  post:
    - mv build/reports $CIRCLE_TEST_REPORTS/xcode # relies on xcpretty --report junit
    - bash <(curl -s https://codecov.io/bash)
    # Save Pods to artifacts in case we need to dig up dependencies later
    - zip -FSr $CIRCLE_ARTIFACTS/Pods.zip ./Pods/
