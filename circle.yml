machine:
  xcode:
    version: "8.0"

dependencies:
# Actually we don't need to setup Pods at all because we check them all in...
#   pre:
#     # - brew install xctool # Homebrew is actually not used on circle at the moment
#     - gem install xcpretty
#     - gem install cocoapods -v $(var=$(tail -1 Example/Podfile.lock); echo ${var##COCOAPODS:})
#     - if cd ~/.cocoapods/repos/master; then git pull; else git clone https://github.com/CocoaPods/Specs.git ~/.cocoapods/repos/master; fi
#     - pod setup --verbose
#   override:
#     - make install
#   cache_directories:
#     - Example/Pods
#     - ~/.cocoapods
# So we get to skip all the crazy pod installs
  override:
    - sudo gem install xcpretty
    - sudo gem install cocoapods -v $(var=$(tail -1 Example/Podfile.lock); echo ${var##COCOAPODS:})

test:
  override:
    - make build-pretty
    - make test-pretty
    - make lint
    - make carthage
  post:
    - mv build/reports $CIRCLE_TEST_REPORTS/xcode # relies on xcpretty --report junit
    - bash <(curl -s https://codecov.io/bash)
